{
  "Version": "2012-10-17",
  "Statement": [

    {
      "Sid": "AllowELBServiceLinkedRole",
      "Effect": "Allow",
      "Action": "iam:CreateServiceLinkedRole",
      "Resource": "*",
      "Condition": {
        "StringEquals": {
          "iam:AWSServiceName": "elasticloadbalancing.amazonaws.com"
        }
      }
    },

    {
      "Sid": "EC2ReadOnlyForEKSNetworking",
      "Effect": "Allow",
      "Action": [
        "ec2:DescribeInstances",
        "ec2:DescribeSecurityGroups",
        "ec2:DescribeSubnets",
        "ec2:DescribeVpcs",
        "ec2:DescribeAvailabilityZones"
      ],
      "Resource": "*"
    },

    {
      "Sid": "SecurityGroupOnlyForThisCluster",
      "Effect": "Allow",
      "Action": [
        "ec2:CreateSecurityGroup",
        "ec2:DeleteSecurityGroup",
        "ec2:AuthorizeSecurityGroupIngress",
        "ec2:RevokeSecurityGroupIngress"
      ],
      "Resource": "arn:aws:ec2:us-east-1:123456789012:security-group/*",
      "Condition": {
        "StringEquals": {
          "aws:ResourceTag/elbv2.k8s.aws/cluster": "demo-eks-cluster"
        }
      }
    },

    {
      "Sid": "ALBOnlyForThisCluster",
      "Effect": "Allow",
      "Action": [
        "elasticloadbalancing:CreateLoadBalancer",
        "elasticloadbalancing:DeleteLoadBalancer",
        "elasticloadbalancing:CreateTargetGroup",
        "elasticloadbalancing:DeleteTargetGroup",
        "elasticloadbalancing:CreateListener",
        "elasticloadbalancing:DeleteListener",
        "elasticloadbalancing:ModifyListener",
        "elasticloadbalancing:ModifyTargetGroupAttributes",
        "elasticloadbalancing:AddTags",
        "elasticloadbalancing:RemoveTags",
        "elasticloadbalancing:Describe*"
      ],
      "Resource": [
        "arn:aws:elasticloadbalancing:us-east-1:123456789012:loadbalancer/*",
        "arn:aws:elasticloadbalancing:us-east-1:123456789012:targetgroup/*/*",
        "arn:aws:elasticloadbalancing:us-east-1:123456789012:listener/*/*/*"
      ],
      "Condition": {
        "StringEquals": {
          "aws:ResourceTag/elbv2.k8s.aws/cluster": "demo-eks-cluster"
        }
      }
    },

    {
      "Sid": "ACMOnlyForThisCert",
      "Effect": "Allow",
      "Action": [
        "acm:DescribeCertificate",
        "acm:GetCertificate"
      ],
      "Resource": "arn:aws:acm:us-east-1:123456789012:certificate/*"
    },

    {
      "Sid": "EKSOnlyThisCluster",
      "Effect": "Allow",
      "Action": "eks:*",
      "Resource": "arn:aws:eks:us-east-1:123456789012:cluster/demo-eks-cluster"
    },

    {
      "Sid": "ECROnlyThisRepo",
      "Effect": "Allow",
      "Action": "ecr:*",
      "Resource": "arn:aws:ecr:us-east-1:123456789012:repository/demo-repo"
    }
  ]
}
